{
  "policyUpi": "PC-AZR-COS-784",
  "policyId": "8fc7b6c0-d6c2-4f29-ad98-d837e7a74ec7",
  "policyType": "config",
  "cloudType": "azure",
  "severity": "low",
  "name": "Azure Cosmos DB key based authentication is enabled",
  "description": "Unauthorized access to Azure Cosmos DB can occur if key-based authentication is enabled without proper controls. Improper configuration of key-based authentication exposes sensitive data and allows attackers to alter database settings.\n\nAzure Cosmos DB's key-based authentication allows access using account keys. Disabling metadata write access via account keys enhances security by preventing unauthorized modifications to database resources. Compromised keys could lead to data breaches or service disruptions.\n\nThe impact of this misconfiguration includes data loss, unauthorized data modification, and potential service disruption. Restricting key-based access minimizes the blast radius of a compromised key, improving overall security posture and ensuring data integrity.\n\nImplement role-based access control ('RBAC') to manage access to Azure Cosmos DB resources. Regularly rotate account keys and use strong, unique keys. Consider limiting the number of users with 'read' and 'write' permissions to only authorized personnel.",
  "rule.criteria": "ef14d0a6-8ed0-4f7a-9877-15efa3194737",
  "searchModel.query": "config from cloud.resource where cloud.type = 'azure' AND api.name = 'azure-cosmos-db' AND json.rule = properties.provisioningState equals Succeeded and properties.disableKeyBasedMetadataWriteAccess is false",
  "recommendation": "Refer to the following URL to disable key-based metadata write access on your Azure Cosmos DB:\nhttps://docs.microsoft.com/en-us/azure/cosmos-db/role-based-access-control#prevent-sdk-changes",
  "remediable": true,
  "remediation.cliScriptTemplate": "az cosmosdb update --name ${resourceName} --resource-group ${resourceGroup} --disable-key-based-metadata-write-access true",
  "remediation.description": "This CLI command requires 'Microsoft.DocumentDB/databaseAccounts/write' permission. Successful execution will disable key based metadata write access on your cosmosdb.",
  "remediation.impact": "Disables key based metadata write access on Cosmosdb",
  "compliance.standard": [
    "ACSC Information Security Manual (ISM)",
    "ACSC Information Security Manual (ISM) (Latest)",
    "Australian Cyber Security Centre (ACSC) Essential Eight",
    "Australian Cyber Security Centre (ACSC) Essential Eight - Level 1",
    "Australian Cyber Security Centre (ACSC) Essential Eight - Level 2",
    "Australian Cyber Security Centre (ACSC) Essential Eight - Level 3",
    "Australian Energy Sector Cyber Security Framework (AESCSF)",
    "CIS Controls v7.1",
    "CIS Controls v8",
    "CIS Controls v8.1",
    "CIS v2.0.0 (Azure) Level 1",
    "CIS v2.1.0 (Azure) Level 1",
    "CIS v3.0.0 (Azure) Level 1",
    "CSA CCM v.4.0.6",
    "CSA CCM v4.0.12",
    "FFIEC",
    "HIPAA",
    "ISO 27002:2022",
    "ISO/IEC 27001:2022",
    "ITSG-33",
    "Insurance Regulatory And Development Authority Of India",
    "MITRE ATT&CK v10.0 [Deprecated]",
    "MITRE ATT&CK v12",
    "MITRE ATT&CK v13.0 Cloud IaaS for Enterprise",
    "MITRE ATT&CK v14.0 Cloud IaaS for Enterprise",
    "MITRE ATT&CK v15.1 Cloud IaaS for Enterprise",
    "MLPS 2.0 (Level 2)",
    "Microsoft Cloud Security Benchmark v1",
    "PCI DSS v4.0",
    "PCI DSS v4.0.1",
    "RBI Baseline Cyber Security and Resilience Requirements",
    "Sarbanes Oxley Act (SOX)",
    "Secure Controls Framework (SCF) - 2022.2.1",
    "TX-RAMP Level 1",
    "TX-RAMP Level 2",
    "Trusted Information Security Assessment Exchange (TISAX)"
  ]
}